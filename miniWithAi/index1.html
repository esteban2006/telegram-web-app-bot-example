<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            font-family: 'Roboto', sans-serif;
            color: #03dac5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            flex-direction: column;
        }
        .container {
            text-align: center;
        }
        .lottie-img {
            width: 256px;
            height: 256px;
        }
        .buttons {
            margin-top: 20px;
        }
        .button {
            background-color: #BB86FB;
            border: none;
            border-radius: 50px;
            color: white;
            padding: 15px 30px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            width: 180px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #121212;
            padding: 20px;
            border-radius: 20px; /* Rounded corners for modal */
            color: #03dac5;
            max-width: 80%;
            max-height: 80%; /* Limit modal size */
            overflow: hidden; /* Hide overflow */
        }
        .modal-content.scrollable {
            overflow-y: auto;
            -ms-overflow-style: none;  /* Hide scrollbar in IE and Edge */
            scrollbar-width: none;  /* Hide scrollbar in Firefox */
        }
        .modal-content.scrollable::-webkit-scrollbar {
            display: none;  /* Hide scrollbar in Chrome, Safari, and Opera */
        }
        .close-btn {
            background-color: #BB86FB;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
        }
        ul {
            text-align: left;
            padding-left: 0;
        }
        ul li {
            list-style: none;
            margin: 10px 0;
            color: #03dac5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="lottie-container" class="lottie-img"></div>
        <p id="language-text"></p>
        <div class="buttons">
            <button class="button" id="give-btn">Give</button>
            <button class="button" id="receive-btn">Receive</button>
            <button class="button" id="view-list-btn">View List</button>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qr-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="close-qr-btn">Close</button>
            <div id="qr-code"></div>
        </div>
    </div>

    <!-- List Modal -->
    <div id="list-modal" class="modal">
        <div class="modal-content scrollable"> <!-- Scrollable list modal -->
            <button class="close-btn" id="close-list-btn">Close</button>
            <div id="list-container"></div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest"></script>
    <script>
        const unsafeData = Telegram.WebApp.initDataUnsafe;

        // Load Lottie Animation
        const lottieContainer = document.getElementById('lottie-container');
        const lottiePlayer = document.createElement('lottie-player');
        lottiePlayer.setAttribute('src', 'https://assets5.lottiefiles.com/packages/lf20_V9t630.json'); // Replace with your Lottie URL
        lottiePlayer.setAttribute('background', 'transparent');
        lottiePlayer.setAttribute('speed', '1');
        lottiePlayer.setAttribute('loop', '');
        lottiePlayer.setAttribute('autoplay', '');
        lottieContainer.appendChild(lottiePlayer);

        // Display user's language
        const languageText = document.getElementById('language-text');
        const userLanguage = unsafeData.user.language_code;
        languageText.textContent = `Your current language is ${userLanguage}`;

        // Handle Give button (opens QR code reader)
        document.getElementById('give-btn').addEventListener('click', () => {
            Telegram.WebApp.showScanQrPopup({
                text: 'for test purposes'
            }, function (text) {
                if (text.toLowerCase().startsWith('http://') || text.toLowerCase().startsWith('https://')) {
                    setTimeout(() => {
                        Telegram.WebApp.openLink(text);
                    }, 50);
                } else {
                    alert(`Scanned text: ${text}`);
                }
            });
        });

        // Open QR Code Modal
        const qrModal = document.getElementById('qr-modal');
        const qrCodeContainer = document.getElementById('qr-code');
        document.getElementById('receive-btn').addEventListener('click', () => {
            qrModal.style.display = 'flex';
            qrCodeContainer.innerHTML = ''; // Clear previous QR code
            new QRCode(qrCodeContainer, {
                text: unsafeData.user.id,
                width: 256,
                height: 256,
                // Applying QR code options here
                dotsOptions: {
                    color: "#e77723",
                    type: "extra-rounded"
                },
                backgroundOptions: {
                    color: "#121212"
                },
                imageOptions: {
                    crossOrigin: "anonymous",
                    margin: 20
                },
                cornersSquareOptions: {
                    type: "extra-rounded",
                    color: "#e77723"
                }
            });
        });

        // Close QR Modal
        document.getElementById('close-qr-btn').addEventListener('click', () => {
            qrModal.style.display = 'none';
        });

        // Open List Modal
        const listModal = document.getElementById('list-modal');
        document.getElementById('view-list-btn').addEventListener('click', () => {
            listModal.style.display = 'flex';
            const listContainer = document.getElementById('list-container');
            listContainer.innerHTML = ''; // Clear previous list
            const randomList = generateRandomList();
            const ul = document.createElement('ul');
            randomList.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `ID: ${item.id}, Status: ${item.status}`;
                ul.appendChild(li);
            });
            listContainer.appendChild(ul);
        });

        // Close List Modal
        document.getElementById('close-list-btn').addEventListener('click', () => {
            listModal.style.display = 'none';
        });

        // Helper function to generate a random list
        function generateRandomList() {
            const statusOptions = ['paid', 'pending'];
            let list = [];
            for (let i = 0; i < 20; i++) {  // Increased list size for testing scrollable modal
                list.push({
                    id: Math.floor(Math.random() * 1000),
                    status: statusOptions[Math.floor(Math.random() * statusOptions.length)]
                });
            }
            return list;
        }
    </script>
</body>
</html>
